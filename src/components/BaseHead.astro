---
// Import the global.css file here so that it is included on
// all pages through the use of the <BaseHead /> component.
import '../styles/global.css';
import type { ImageMetadata } from 'astro';
import FallbackImage from '../assets/og-fallback.webp';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

interface Props {
    title?: string;
    description?: string;
    image?: ImageMetadata | string;
    keywords?: string | string[];
    author?: string;
    robots?: string;
    ogTitle?: string;
    ogDescription?: string;
    ogImage?: ImageMetadata | string;
    ogType?: string;
    twitterCard?: string; // e.g. summary_large_image
    twitterTitle?: string;
    twitterDescription?: string;
    twitterImage?: ImageMetadata | string;
    canonicalUrl?: string; // absolute or path
}

const props = Astro.props as Partial<Props>;
const DEFAULTS = {
    title: 'Stack Insight | Modern Web Development Insights & Tutorials',
    description:
        'Get the latest insights, tutorials, and best practices in web development, programming, and software engineering from industry experts.',
    keywords:
        'web development, programming, software engineering, tutorials, coding, frontend, backend, fullstack, javascript, typescript, angular, react, vue',
    author: 'Stack Insight',
    robots: 'index, follow',
    themeColor: '#2563eb',
    twitterCard: 'summary_large_image',
};

const pageTitle = props.title ?? DEFAULTS.title ?? SITE_TITLE;
const pageDescription = props.description ?? DEFAULTS.description ?? SITE_DESCRIPTION;
const keywords = Array.isArray(props.keywords)
    ? props.keywords.join(', ')
    : props.keywords ?? DEFAULTS.keywords;
const author = props.author ?? DEFAULTS.author;
const robots = props.robots ?? DEFAULTS.robots;
const twitterCard = props.twitterCard ?? DEFAULTS.twitterCard;
const canonicalURL = new URL(props.canonicalUrl ?? Astro.url.pathname, Astro.site);

// Resolve images for OG/Twitter
const primaryImage = props.ogImage ?? props.image ?? FallbackImage;
const ogImageUrl = new URL(
    typeof primaryImage === 'string' ? primaryImage : primaryImage.src,
    Astro.url,
);

const twitterImage = props.twitterImage ?? primaryImage;
const twitterImageUrl = new URL(
    typeof twitterImage === 'string' ? twitterImage : twitterImage.src,
    Astro.url,
);

const ogTitle = props.ogTitle ?? pageTitle;
const ogDescription = props.ogDescription ?? pageDescription;
const twitterTitle = props.twitterTitle ?? pageTitle;
const twitterDescription = props.twitterDescription ?? pageDescription;
const ogType = props.ogType ?? 'website';
---

<!-- Global Metadata -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="manifest" href="/site.webmanifest" />
<link rel="sitemap" href="/sitemap-index.xml" />
<link
	rel="alternate"
	type="application/rss+xml"
	title={SITE_TITLE}
	href={new URL('rss.xml', Astro.site)}
/>
<meta name="generator" content={Astro.generator} />

<!-- Font preloads -->
<link rel="preload" href="/fonts/Ubuntu-Regular.ttf" as="font" type="font/ttf" crossorigin />
<link rel="preload" href="/fonts/Rokkitt-VariableFont_wght.ttf" as="font" type="font/ttf" crossorigin />

<link rel="canonical" href={canonicalURL} />
<link rel="alternate" hreflang="en" href={canonicalURL} />

<!-- Primary Meta Tags -->
<title>{pageTitle}</title>
<meta name="title" content={pageTitle} />
<meta name="description" content={pageDescription} />
<meta name="keywords" content={keywords} />
<meta name="author" content={author} />
<meta name="robots" content={robots} />
<meta name="theme-color" content={DEFAULTS.themeColor} />

<meta property="og:type" content={ogType} />
<meta property="og:site_name" content={SITE_TITLE} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:title" content={ogTitle} />
<meta property="og:description" content={ogDescription} />
<meta property="og:image" content={ogImageUrl} />
<meta property="og:locale" content="en_US" />

<!-- Twitter -->
<meta property="twitter:card" content={twitterCard} />
<meta property="twitter:url" content={canonicalURL} />
<meta property="twitter:title" content={twitterTitle} />
<meta property="twitter:description" content={twitterDescription} />
<meta property="twitter:image" content={twitterImageUrl} />

<!-- End Meta Tags -->